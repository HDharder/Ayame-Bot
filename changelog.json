{
  "updates": [
    {
      "version": "2.2.2",
      "date": "2025-11-12",
      "title": "Persist√™ncia de Estado (Anti-Crash) e Novo Sistema de Rea√ß√µes",
      "features": [
        "**Novo: Sistema de Rea√ß√£o (`reactionManager.js`):** O bot agora pode 'ouvir' rea√ß√µes em mensagens espec√≠ficas (atualmente usado pelo `/abrir-mesa`).",
        "**`/abrir-mesa` Atualizado (Agora usa Rea√ß√µes):**",
        "Adicionada a rea√ß√£o üìã (clipboard) como uma ferramenta de emerg√™ncia: O mestre pode reagir com üìã para reativar os bot√µes (Fechar/Editar/Cancelar) caso eles travem ou falhem."
      ],
      "fixes": [
        "Corrigido um bug de 'condi√ß√£o de corrida' no `/abrir-mesa` onde o bot tentava ler os inscritos (rea√ß√µes) *depois* de j√° os ter removido, fazendo com que a lista de inscritos falhasse."
      ],
      "backend": [
        "**Estabilidade Cr√≠tica (Persist√™ncia de Estado):** Implementado um sistema (`saveAllStates`, `loadAllStates`) em `index.js` que salva todos os estados pendentes (Propostas P2P, Ouvintes de Rea√ß√£o, etc.) em ficheiros JSON na pasta `/states/`.",
        "O bot agora recarrega estes estados ao reiniciar, garantindo que os bot√µes (P2P, `/abrir-mesa`) sobrevivam a rein√≠cios ou 'crashes'.",
        "Adicionados 'hooks' de desligamento (`SIGINT`) e 'crash' (`uncaughtException`) para for√ßar um salvamento de emerg√™ncia, garantindo perda m√≠nima de dados.",
        "**Estabilidade Cr√≠tica (Fuga de Mem√≥ria):** Refatorado o 'Recolhedor de Lixo' (`forceCleanup`) para limpar estados com `timestamp` (Bug 2).",
        "**Estabilidade Cr√≠tica (API):** Implementada a fila global `saveRow` para resolver o `[429] Quota Exceeded` (Write) (Bug 3)."
      ]
    },
    {
      "version": "2.2.1",
      "date": "2025-11-11",
      "title": "Hotfix - Corre√ß√£o de API (Erro 429) na Pagina√ß√£o do /transacao",
      "features": [],
      "fixes": [
        "Corrigido um erro cr√≠tico `[429] Quota Exceeded (Read requests)` que ocorria ao usar os bot√µes de pagina√ß√£o (Pr√≥xima/Anterior) ou 'Filtrar' nos menus de Compra e Venda do `/transacao`."
      ],
      "backend": [
        "As fun√ß√µes `buildPaginatedShopMenu` e `buildSellSelectMenu` (`utils/transacaoUtils.js`) foram refatoradas para usar um cache de estado (`state.shopRowsCache`, `state.priceCache`).",
        "O bot agora l√™ os dados da loja da planilha *uma vez* ao abrir o menu, em vez de fazer um novo pedido √† API do Google a cada clique de bot√£o, resolvendo o 'rate limit' de leitura."
      ]
    },
    {
      "version": "2.2.0",
      "date": "2025-11-11",
      "title": "Transa√ß√µes P2P e Overhaul de Estabilidade (API/RAM)",
      "features": [
        "**Novo: Transa√ß√µes Jogador-para-Jogador (P2P)!**",
        "O comando `/transacao` agora pode ser usado em canais de Invent√°rio (designados com `[Players]` na planilha) para iniciar uma venda P2P.",
        "O Vendedor seleciona itens do seu invent√°rio e o bot calcula um 'Pre√ßo Sugerido' (50% para itens, 100% para materiais/ervas).",
        "O Vendedor define um pre√ßo final num novo modal (`transacao_venda_modal`).",
        "Uma mensagem p√∫blica de confirma√ß√£o √© enviada, com bot√µes 'Sim, Aceitar' e 'N√£o, Recusar'.",
        "Apenas o Comprador (dono do canal de invent√°rio) pode aceitar ou recusar a proposta.",
        "Ao aceitar, o bot *automaticamente* verifica o saldo do comprador e transfere o ouro e os itens entre os invent√°rios de ambos.",
        "A transa√ß√£o P2P √© registada na aba da planilha especificada no `tipo de loja` (ex: 'Players').",
        "**`/exibir` agora mostra o Hist√≥rico P2P:** Adicionada a nova op√ß√£o `Hist√≥rico de Transa√ß√µes (P2P)`.",
        "O bot agora l√™ todas as abas de loja marcadas com `[Players]` para compilar um hist√≥rico completo de Vendas e Compras P2P do personagem."
      ],
      "fixes": [
        "**Corre√ß√£o Cr√≠tica (Economia):** A transa√ß√£o P2P agora verifica o saldo de ouro do Comprador *antes* de confirmar a transa√ß√£o, impedindo a explora√ß√£o de ouro negativo (Bug 1).",
        "Corrigido o `handleButton` do `/transacao` para que os bot√µes 'Sim/N√£o' (P2P) possam ser clicados pelo Comprador (em vez de apenas pelo Vendedor).",
        "Corrigido um bug em que os bot√µes 'Sim/N√£o' n√£o desapareciam ao clicar, causando um erro de 'Intera√ß√£o falhou' (timeout de 3 segundos). Os bot√µes agora s√£o removidos instantaneamente.",
        "Corrigida a fun√ß√£o `cacheSellPrices` (`utils/transacaoUtils.js`) para ler corretamente os pre√ßos das abas 'Itens' e 'Po√ß√£o', resolvendo o erro `Duplicate header detected: \"Qntd\"`.",
        "Corrigidos v√°rios erros `This cell has not been loaded yet` no `cacheSellPrices` e `buildSellSelectMenu`.",
        "Corrigidos v√°rios `ReferenceError` no fluxo P2P (ex: `lookupIds`, `p2p_state.buyer.id`, `sellerPayload_AddItems`).",
        "Corrigido o erro `SET_TYPE_ALREADY_CONTAINS_VALUE` (API do Discord) ao usar `new Set()` para as men√ß√µes, permitindo testes P2P com uma √∫nica conta.",
        "Atualizado o `/help transacao` para incluir a documenta√ß√£o da nova funcionalidade P2P e corrigir a descri√ß√£o de Venda (que estava 'N√£o implementado')."
      ],
      "backend": [
        "**Corre√ß√£o Cr√≠tica (Estabilidade API):** Implementada uma fila global (`saveRow` em `google.js`) para serializar todas as opera√ß√µes de escrita (`row.save()`) na planilha. Isto resolve o risco de erros `[429] Quota Exceeded` (Write) durante picos de uso (Bug 3).",
        "**Corre√ß√£o Cr√≠tica (Fuga de Mem√≥ria):** Refatorado o 'Recolhedor de Lixo' (`forceCleanup`) para ler estados que usam `timestamp` em vez de apenas `Interaction IDs`. Todos os estados de longa dura√ß√£o (`pendingP2PTrades`, `pendingRolls`, etc.) foram atualizados para usar este novo wrapper, resolvendo a fuga de mem√≥ria (Bug 2).",
        "Corrigido um bug de 'Condi√ß√£o de Corrida' (`Rollem Race Condition`) onde um jogador podia ter m√∫ltiplas 'brechas de rolagem' abertas no mesmo canal. O bot agora ignora a abertura de uma nova brecha se uma j√° existir (Bug 5)."
      ]
    },
    {
      "version": "2.1.0",
      "date": "2025-11-11",
      "title": "Integra√ß√£o com Rollem e Otimiza√ß√£o de Performance",
      "features": [
        "**Integra√ß√£o com o Bot Rollem:** O bot agora \"escuta\" ativamente as respostas do bot Rollem (`rollem#7705`) para validar rolagens de comandos.",
        "**Mec√¢nica de Persuas√£o (`{cd}`) em Lojas:** Lojas marcadas com `{CD}` (ex: `Loja*{15}`) na planilha `Player ID` agora abrem uma \"brecha de rolagem\".",
        "Se o jogador fizer uma rolagem de `d20` com o \"Termo\" correto (definido na loja, ex: \"persuas√£o\") e passar no CD, a loja √© atualizada *visualmente* (e funcionalmente) para usar os pre√ßos de desconto (colunas `Pre√ßo (cd)` e `Fator de Venda (cd)`).",
        "A rolagem de persuas√£o √© invalidada se a rolagem final tiver mais de um dado (ex: `2d20` sem o kh1), pois o sistema verifica se apenas 1 dado `d20` v√°lido foi rolado.",
        "**Confirma√ß√£o de Rolagem:** Se o jogador fizer uma rolagem de `d20` v√°lida (1 dado, no canal certo) mas esquecer o \"Termo\" (ex: \"persuas√£o\"), o bot perguntar√° (com bot√µes Sim/N√£o) se aquela rolagem deve contar.",
        "A brecha de rolagem √© agora corretamente fechada em todos os cen√°rios (sucesso, falha, clique em 'N√£o' ou ao finalizar a transa√ß√£o)."
      ],
      "fixes": [
        "Corrigido o erro cr√≠tico `[429] Quota Exceeded` (Google API) que ocorria durante picos de uso (ex: `/transacao`, `/loot`).",
        "Corrigido o erro `Disallowed intents` que impedia o bot de iniciar (requer ativa√ß√£o manual da 'MESSAGE CONTENT INTENT' no Portal de Desenvolvedores do Discord).",
        "Corrigido o erro `Unknown Interaction` (timeout de 3 segundos) ao clicar nos bot√µes 'Comprar' ou 'Vender'. O bot agora mostra \"Carregando...\" imediatamente.",
        "Corrigido o bug `Unknown Message` que impedia a atualiza√ß√£o do menu da loja ap√≥s a rolagem de persuas√£o. O `shopMessageId` agora √© rastreado corretamente.",
        "Corrigido o bug em que o total da Venda era `0 PO`. O parser agora l√™ a descri√ß√£o de pre√ßo din√¢mica (ex: `Venda (CD): XX PO`).",
        "Corrigido o erro `This cell has not been loaded yet` no menu de Venda ao carregar as c√©lulas `F2` e `G2` (Fatores de Venda)."
      ],
      "backend": [
        "Implementado um cache global (`client.inventoryEmbedData`) para os dados de embed (`Tokens`, `N√≠vel`, `XP`). O cache √© carregado na inicializa√ß√£o e atualizado a cada 15 minutos, resolvendo a falha de quota da API do Google.",
        "Otimizado drasticamente o uso de RAM em `index.js` ao configurar o `makeCache` do `discord.js`. Caches desnecess√°rios (como `UserManager`, `GuildMemberManager`, `PresenceManager`) foram desabilitados ou limitados.",
        "Adicionadas as `Intents` `GuildMessages` e `MessageContent` ao `index.js`.",
        "Adicionado `client.pendingRolls` e `client.pendingRollConfirmations` (com limpeza pelo 'Recolhedor de Lixo').",
        "Criado `utils/rollemListener.js` com um parser de regex para analisar as respostas complexas do Rollem (incluindo `~~descartados~~`, `**cr√≠ticos**` e rolagens mistas).",
        "Criado `utils/rollObserver.js` para gerir os bot√µes de confirma√ß√£o (Sim/N√£o)."
      ]
    },
    {
      "version": "2.0.1",
      "date": "2025-11-06",
      "title": "Hotfix - Corrigido o fluxo do `/inventario`",
      "features": [],
      "fixes": [
        "Corrigido o fluxo do `/inventario` para que as respostas (para 1 ou >1 personagem) sejam sempre **p√∫blicas** e **independentes** (n√£o-ef√™meras e sem 'reply')."
      ],
      "backend": []
    },
    {
      "version": "2.0.0",
      "date": "2025-11-05",
      "title": "A Ascens√£o da Economia: Comandos /transacao, /gasto, /exibir e /staff",
      "features": [
        "**Sistema de Lojas e Transa√ß√µes (`/transacao`)**",
        "Agora voc√™ pode comprar e vender itens em canais de mercado designados!",
        "O bot l√™ as regras da planilha 'Player ID' para saber se um mercado √© de 'Compra', 'Venda', 'Compra e Venda' ou 'Servi√ßos'.",
        "Suporte a lojas com `[Estoque]` limitado (que √© debitado na compra) e `[Caravana]` (que agenda a entrega para a data da pr√≥xima segunda).",
        "Lojas com `*` (ex: `Loja*`) s√≥ podem ser acedidas por personagens que est√£o atualmente numa mesa ativa (`Controle de mesas`).",
        "Lojas com `(Nome da Loja)` (ex: `Guilda (O Pavilh√£o)`) filtram a aba principal pela coluna 'Loja'.",
        "Novo sistema de Filtro üîé: Permite filtrar lojas/invent√°rios. Use `(A, B)` para `E` (AND), e `,` para `OU` (OR). Ex: `(po√ß√£o, cura), adaga`.",
        "\n",
        
        "**Gest√£o de Invent√°rio (`/gasto` e `/exibir`)**",
        "Novo comando `/gasto`: Permite remover Ouro ou Itens do seu invent√°rio com uma justifica√ß√£o (Observa√ß√£o).",
        "O `/gasto` agora valida se voc√™ tem os itens/ouro antes de os remover.",
        "O log do `/gasto` √© guardado no pr√≥prio canal do invent√°rio e o ID da mensagem √© salvo na sua planilha.",
        "Novo comando `/exibir`: Permite ver hist√≥ricos do seu personagem no canal do invent√°rio.",
        "`/exibir gastos`: Mostra um hist√≥rico paginado de todos os seus gastos registados com o `/gasto`.",
        "`/exibir mesas_jogadas`: Mostra todo o loot (incluindo Gold Extra e Dobro) que voc√™ recebeu de mesas finalizadas.",
        "\n",
        
        "**Painel de Staff (`/staff`)**",
        "Novo comando `/staff` exclusivo para Staffs.",
        "Exibe estat√≠sticas do servidor (Jogadores, Personagens, Nv. M√°ximo, Mesas da Semana).",
        "Verifica a 'Caravana Basti√£o' e ativa um bot√£o se a entrega estiver pronta (comparando H1, K1 e N1).",
        "O bot√£o 'Distribuir Caravana' entrega os itens a todos os jogadores na lista e limpa a aba.",
        "\n",

        "**Estabilidade do Bot (Gest√£o de RAM)**",
        "O bot agora monitoriza o uso de RAM. Se a RAM usada (RSS) ultrapassar o limite definido no `.env` (RAM_LIMIT_MB), o bot for√ßa uma limpeza de estados antigos antes de executar um novo comando.",
        "Adicionado um 'Recolhedor de Lixo' que corre a cada hora para limpar estados de comandos abandonados (ex: `/loot` ou `/transacao` abertos h√° mais de 1 horas)."
      ],
      "fixes": [
        "Corrigido o `/gasto` e o `/exibir` para funcionar corretamente em canais de F√≥rum (Invent√°rios), lendo e escrevendo no canal correto.",
        "Corrigido o `Unknown Interaction` (erro de 3 segundos) nos bot√µes de Compra/Venda ao adicionar `interaction.update()` para feedback imediato.",
        "Corrigido o `Unknown Message` no `processCompra` ao guardar o ID da mensagem da loja (`shopMessageId`) no estado.",
        "Corrigidos v√°rios erros `Invalid Form Body` nos menus de filtro, garantindo que `setMaxValues` nunca seja maior que as op√ß√µes dispon√≠veis."
      ],
      "backend": [
        "Adicionada a fun√ß√£o `batchRemoveInventories` ao `inventoryManager.js` para remo√ß√£o de itens/ouro.",
        "Criados os novos utilit√°rios: `utils/staffUtils.js`, `utils/transacaoUtils.js`, `utils/filterManager.js` e `utils/modalUtils.js`.",
        "A l√≥gica de c√°lculo da data da Caravana foi corrigida para for√ßar o ano para '20xx' (ex: '25' -> '2025')."
      ]
    },
    {
      "version": "1.4.2",
      "date": "2025-11-03",
      "title": "Hotfix /exibir: Leitura de Logs em F√≥runs",
      "features": [],
      "fixes": [
        "Corrigido o comando `/exibir opcao: Hist√≥rico de Gastos` que n√£o encontrava as mensagens de log quando usado em um canal de f√≥rum (Invent√°rio).",
        "O comando agora procura os logs no canal atual (`interaction.channel`), em vez de procurar no canal de log global (`LOG_CHANNEL_ID`)."
      ],
      "backend": []
    },
    {
      "version": "1.4.1",
      "date": "2025-11-03",
      "title": "Corre√ß√£o do /gasto: Logs no Canal Correto",
      "features": [],
      "fixes": [
        "Corrigido o comando `/gasto` que enviava a mensagem de log para o canal de log global em vez do canal de invent√°rio do jogador."
      ],
      "backend": []
    },
    {
      "version": "1.4.0",
      "date": "2025-11-03",
      "title": "Novos Comandos de Invent√°rio: /gasto e /exibir",
      "features": [
        "**Novo Comando `/gasto`:** Permite que jogadores registem gastos de Ouro ou Itens.",
        "O `/gasto` s√≥ pode ser usado no canal de invent√°rio registado do jogador.",
        "O comando envia um log detalhado para o canal de invent√°rio e salva o ID da mensagem de log na coluna 'Gastos' da planilha do jogador.",
        "**Novo Comando `/exibir`:** Permite que jogadores consultem hist√≥ricos relacionados ao seu personagem.",
        "**`/exibir opcao: Hist√≥rico de Gastos`:** Busca todos os IDs de log da coluna 'Gastos', formata-os num Embed paginado e exibe ao jogador, incluindo data, hora, ouro, itens e motivo.",
        "**`/exibir opcao: Hist√≥rico de Mesas Jogadas`:** Busca no 'Controle de Mesas' todas as mesas finalizadas ('Sim') que o personagem jogou.",
        "O hist√≥rico de mesas exibe o Mestre, Tier, e o loot final (processando corretamente o 'Dobro Ativado' e itens de 'Gold Extra')."
      ],
      "fixes": [],
      "backend": [
        "**Nova Fun√ß√£o `batchRemoveInventories`:** Criada em `inventoryManager.js` para remover Ouro e Itens em lote, atualizando a planilha e os embeds do Discord.",
        "**Novo Utilit√°rio `exibirUtils.js`:** Criado para modularizar a l√≥gica de busca e processamento do hist√≥rico de mesas jogadas."
      ]
    },
    {
      "version": "1.3.7",
      "date": "2025-11-02",
      "title": "/loot: Corre√ß√£o na Agrega√ß√£o de Itens Pr√©-definidos",
      "features": [],
      "fixes": [
        "Corrigido um bug cr√≠tico no `/loot` onde itens normais e itens pr√©-definidos (`*`) com o mesmo nome (ex: 'Po√ß√£o de Cura' e 'Po√ß√£o de Cura*') eram incorretamente agrupados como um √∫nico item."
      ],
      "backend": [
        "O sistema de parse e agrega√ß√£o de itens foi refatorado para usar uma chave composta (`nome|isPredefined`) em vez de apenas `item.name`.",
        "Atualizadas as fun√ß√µes `parseItemInput`, `getAvailableDrops`, `formatPlayerList`, `finalizar_loot` e `updateHistoricoSheet` para usar a nova l√≥gica de chave composta.",
        "Atualizados os menus de sele√ß√£o (simples e paginado) para incluir a flag `isPredefined` no `value` do item, permitindo a diferencia√ß√£o."
      ]
    },
    {
      "version": "1.3.5",
      "date": "2025-11-01",
      "title": "Melhorias no /loot: Gold Extra como Item",
      "features": [
        "**Gold Extra no `/loot`:** Adicionado o par√¢metro opcional `gold_extra: True` ao `/loot`, que habilita um bot√£o 'Adicionar Gold Extra'.",
        "O mestre pode agora adicionar 'itens de gold' (ex: `100 PO`, `2x 50`, `150 PO*`) como drops no loot.",
        "O parser de 'Gold Extra' foi atualizado para aceitar valores com ou sem `PO` (ex: `100` ou `100 PO`), mas sempre formata a sa√≠da como `XX.XX PO`.",
        "Itens de 'Gold Extra' agora podem ser marcados com `*` para serem dobrados pelo 'Double Gold' (ex: `2x 100 PO*`)."
      ],
      "fixes": [
        "Corrigido o `handleEncerrarMesaClick` no `lootUtils.js` para processar corretamente os 'itens de gold' pegos pelos jogadores, somando-os ao gold total do invent√°rio em vez de adicion√°-los como itens."
      ],
      "backend": [
        "O `handleModal` do `loot.js` agora tem uma Regex espec√≠fica para lidar com a entrada de 'Gold Extra'."
      ]
    },
    {
      "version": "1.3.4",
      "date": "2025-11-01",
      "title": "Melhorias no /loot: Itens Pr√©-definidos e Corre√ß√µes de L√≥gica",
      "features": [
        "Adicionada a op√ß√£o `drop_de_misc` ao comando `/loot`.",
        "O par√¢metro `loot_previsto` foi renomeado para `nao_rolar_loot_com_vantagem` para maior clareza.",
        "**Itens Pr√©-definidos (`*`):** Itens inseridos no `/loot` com um `*` no final (ex: `Po√ß√£o de Cura*`) agora s√£o dobrados (quantidade x2) para jogadores que ativarem o \"Double Gold\"."
      ],
      "fixes": [
        "Corrigida a contagem de mesa extra do \"Double Gold\" (`/loot`), que estava a ser adicionada na semana *atual* em vez da semana *anterior*."
      ],
      "backend": [
        "O parser de itens (`parseItemInput`) agora reconhece e remove o `*` do nome do item, guardando-o como um booleano (`isPredefined`).",
        "`utils/playerLootUtils.js` foi atualizado para guardar o objeto de item completo (incluindo `isPredefined`) na sele√ß√£o do jogador.",
        "`utils/lootUtils.js` foi atualizado para mostrar o `*` nos logs (`formatPlayerList`) e no menu de sele√ß√£o (`formatDropsList`)."
      ]
    },
    {
      "version": "1.3.3",
      "date": "2025-10-31",
      "title": "Revis√£o do /relatorio & Melhorias de Invent√°rio",
      "features": [
        "**`/relatorio` agora atualiza o invent√°rio:** O comando `/relatorio` agora atualiza o invent√°rio dos jogadores (gold e itens) ao finalizar, tal como o `/loot`.",
        "**Gold Opcional no `/relatorio`:** O par√¢metro `gold_total` agora √© opcional. Se deixado em branco, o bot rolar√° o gold automaticamente (usando a l√≥gica do `/loot`).",
        "**Gold Extra no `/relatorio`:** Adicionado um bot√£o 'Gold Extra' na interface de drops para adicionar b√¥nus de gold individualmente por jogador.",
        "**Drops 'Misc' no `/relatorio`:** Adicionada a op√ß√£o e o bot√£o `drop_misc` para itens que n√£o precisam de valida√ß√£o."
      ],
      "fixes": [
        "**Categoriza√ß√£o de Itens:** Corrigido o sistema de atualiza√ß√£o de invent√°rio (`/loot` e `/relatorio`) para salvar itens nas colunas corretas (ex: a aba 'Po√ß√µes' agora salva em 'Consum√≠veis M√°gicos', e a aba 'Itens' salva em 'Itens M√°gicos').",
        "**Categoriza√ß√£o de Mundanos:** 'Itens Mundanos' agora s√£o classificados corretamente como 'Armas' ou 'Escudos/Armaduras' no invent√°rio, com base na coluna 'Type' da Tabela de Craft."
      ],
      "backend": [
        "O parser de itens (`parseItemInput`) agora suporta a sintaxe de colchetes (ex: `Arma +1 [Espada Longa]`), salvando o nome completo mas usando o nome base (`Arma +1`) para valida√ß√£o e categoriza√ß√£o."
      ]
    },
    {
      "version": "1.3.2",
      "date": "2025-10-31",
      "title": "Comando de Ajuda & Sistema de Autocomplete",
      "features": [
        "**Novo Comando `/help`:** Adicionado comando `/help` para listar todos os comandos ou mostrar detalhes sobre um comando espec√≠fico (uso, permiss√µes)."
      ],
      "fixes": [],
      "backend": [
        "Adicionado suporte para intera√ß√µes `isAutocomplete()` ao `index.js` (roteador de intera√ß√µes).",
        "O comando `/help` usa o novo sistema de autocomplete para sugerir nomes de comandos.",
        "Criado o ficheiro `help.json` para armazenar dinamicamente os textos de ajuda do bot."
      ]
    },
    {
      "version": "1.3.1",
      "date": "2025-10-29",
      "title": "Otimiza√ß√£o de Atualiza√ß√£o de Invent√°rio",
      "features": [],
      "fixes": [
        "**Otimiza√ß√£o Cr√≠tica:** Refatorado o processo de atualiza√ß√£o de invent√°rios (ao usar 'Encerrar Mesa') para usar opera√ß√µes em lote (`batchUpdateInventories`), resolvendo erros de quota da API do Google (`[429] Quota exceeded`).",
        "Corrigido erro `ReferenceError: rowChanged is not defined` que ocorria durante a atualiza√ß√£o em lote de invent√°rios.",
        "Corrigido erro na fun√ß√£o `getItemCategory` que impedia o retorno correto de categorias de itens j√° presentes no cache."
      ],
      "backend": [
        "Implementada fun√ß√£o `preloadInventoryEmbedData` para carregar dados de Tokens, N√≠veis e XP de forma otimizada antes de atualizar m√∫ltiplos invent√°rios.",
        "Implementada fun√ß√£o `preloadItemCategories` para carregar todas as categorias de itens em cache de uma s√≥ vez.",
        "Adicionado um atraso (`delay`) entre as opera√ß√µes de escrita (`row.save()`) na atualiza√ß√£o em lote para mitigar limites de escrita da API."
      ]
    },
    {
      "version": "1.3.0",
      "date": "2025-10-28",
      "title": "Comando /inventario & Fun√ß√µes Gen√©ricas Google",
      "features": [
        "**Novo Comando `/inventario`:** Permite aos jogadores exibir o invent√°rio dos seus personagens num canal dedicado.",
        "O comando `/inventario` regista o canal para o personagem selecionado, impedindo que outros jogadores usem o mesmo canal.",
        "O comando `/inventario` atualiza automaticamente o canal registado e apaga mensagens antigas se o jogador trocar de personagem ou re-executar o comando.",
        "O comando `/inventario` calcula e exibe `N√≠vel / Qtd. Mesas no N√≠vel` buscando dados das abas 'Invent√°rio', 'Prim√°rios'/'Secund√°rios' e 'Player ID'.",
        "O comando `/inventario` exibe Gold (GP/PP/PC), Tokens e itens divididos por categoria (Mundanos, Armas, Armaduras, etc.).",
        "**Restri√ß√£o de Canal:** Implementado `utils/channelGuard.js` que l√™ regras da aba 'Player ID' para restringir onde comandos (como `/inventario`) podem ser usados (Texto, F√≥rum, Categoria)."
      ],
      "fixes": [
        "Corrigidos m√∫ltiplos erros no comando `/inventario` relacionados a timeouts (`Unknown interaction`), valores duplicados no seletor (`SELECT_COMPONENT_OPTION_VALUE_DUPLICATED`), e falhas ao carregar/salvar c√©lulas na planilha (`rowIndex undefined`, `Cell not loaded`, `Unable to parse range`).",
        "Corrigido erro no c√°lculo de `N√≠vel / Qtd. Mesas` que lia a coluna errada ('Total' em vez de 'Mesas Jogadas') na aba 'Prim√°rios'/'Secund√°rios'."
      ],
      "backend": [
        "**Fun√ß√µes Gen√©ricas Google:** Adicionadas `getValueFromSheet`, `setValueInSheet`, `clearValueInSheet` em `utils/google.js` para buscar e alterar c√©lulas individuais de forma segura (preservando f√≥rmulas), usando o m√©todo de itera√ß√£o de c√©lulas.",
        "A fun√ß√£o `registerChannel` em `utils/inventarioUtils.js` foi refatorada para usar as novas fun√ß√µes gen√©ricas."
      ]
    },
    {
      "version": "1.2.0",
      "date": "2025-10-28",
      "title": "Drops Mundanos & Contagem de Mesas",
      "features": [
        "Adicionada a op√ß√£o 'drop_de_mundanos' ao comando `/loot`.",
        "Adicionada valida√ß√£o para a aba 'Itens Mundanos' na Tabela de Craft.",
        "Mestres agora recebem +1 em 'Mesas Mestradas' (planilha 'Tokens') ao usar o bot√£o 'Encerrar Mesa'."
      ],
      "fixes": [
        "Um bug na hora de definir os tokens gastos alterava a linha inteira do jogador escolhido, perdendo todas as f√≥mulas que tinham. Isso foi corrigido para alterar apenas a c√©lula designada ('Double Up')."
      ],
      "backend": []
    },
    {
      "version": "1.1.0",
      "date": "2025-10-27",
      "title": "Refatora√ß√£o de Permiss√µes e Custo do Dobro",
      "features": [
        "Criado o m√≥dulo `utils/auth.js` para centralizar todas as verifica√ß√µes de permiss√£o (Narrador/Staff/Mestre).",
        "Todos os comandos (`/loot`, `/relatorio`, `/abrir-mesa`, etc.) foram atualizados para usar o novo `auth.js`.",
        "A fun√ß√£o `spendPlayerTokens` agora incrementa a coluna 'Double Up' em +1, em vez de subtrair 4 tokens."
      ],
      "fixes": [],
      "backend": []
    },
    {
      "version": "1.0.0",
      "date": "2025-10-24",
      "title": "Lan√ßamento Inicial",
      "features": [
        "Sistema de Loot (`/loot`)",
        "Sistema de Registro de Mesa (`/abrir-mesa`, `/registrar-mesa`)",
        "Sistema de Sorteio (`/sortear`)"
      ],
      "fixes": [],
      "backend": []
    }
  ]
}